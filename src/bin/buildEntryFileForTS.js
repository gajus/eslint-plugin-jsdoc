import {
  readFile,
  writeFile,
} from 'node:fs/promises';

const {
  dirname,
} = import.meta;
const dataToEmbed = await readFile(dirname + '/../index-cjs.js', 'utf8');
const templateContent = await readFile(dirname + '/../index-esm.js', 'utf8');

const finalContent = '/* AUTO-GENERATED BY build SCRIPT */\n' + templateContent.replace(
  /\/\/ BEGIN REPLACE[\s\S]*\/\/ END REPLACE\n/v,
  `${dataToEmbed}`,
).replaceAll(
  // When inserted, will be in the same file
  'import(\'./index-cjs.js\').',
  '',
);
await writeFile(dirname + '/../index.js', finalContent);
